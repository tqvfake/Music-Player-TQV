let currentPlayingTime = 0;
let tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
let firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

function onYouTubeIframeAPIReady() {
  player = new window.YT.Player('player', {
    height: 0,
    width: 0,
    videoId: 'M7lc1UVf-VE',
    playerVars: {
      'playsinline': 1
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  console.log(">>> Player ready");
  playerReady = true;
}

// 5. The API calls this function when the player's state changes.
//    The function indicates that when playing a video (state=1),
//    the player should play for six seconds and then stop.
function onPlayerStateChange(event) {
  if (peerConnected) {
    peerConnection.send({
      type: 'update-player-state',
      data: {
        status: event.data,
        currentTime: player.getCurrentTime()
      }
    });
    if (event.data === 3) {
      setTimeout(() => {
        player.playVideo();
      }, 300);
    }
  }
}
function stopVideo() {
  // player.stopVideo();
}
